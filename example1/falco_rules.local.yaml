- rule: ping: Unauthorized process
  desc: There is a running process not described in the base template
  condition: container and container.image startswith example1_php and spawned_process and not proc.name in (apache2, sh, ping)
  output: Unauthorized process (%proc.cmdline) running in (%container.id)
  priority: ERROR
  tags: [process]


- rule: Apache writing to non allowed directory
  desc: Attempt to write to directories that should be immutable
  condition: container and container.image startswith example1_php and open_write and not (ping_allowed_dirs and proc.name in (apache2))
  output: "Writing to forbidden directory (user=%user.name command=%proc.cmdline file=%fd.name)"
  priority: ERROR
  tags: [filesystem]


- rule: Forbidden network outbound connection
  desc: A non-whitelisted process is trying to reach the Internet
  condition: outbound and not proc.name in (ping)
  output: Forbidden outbound connection (user=%user.name command=%proc.cmdline connection=%fd.name)
  priority: ERROR
  tags: [network]

